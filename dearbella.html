<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Valentine Heart Game</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/game.css">
</head>
<body class="dearbella">

<h1>Find the Hearts ❤️</h1>
<div id="gameBoard"></div>

<canvas id="heartCanvas"></canvas>

<script>
const canvas = document.getElementById("heartCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let hearts = [];

function triggerHeartRain(){
  for(let i=0;i<36;i++){
    const img = new Image();
    img.src = `images/heart${(i%18)+1}.png`;
    hearts.push({
      x: Math.random()*canvas.width,
      y: Math.random()*-canvas.height,
      size: Math.random()*40+30,
      speed: Math.random()*2+1,
      sway: Math.random()*2+1,
      angle: Math.random()*Math.PI*2,
      img: img,
      opacity: Math.random()
    });
  }
  animateHearts();
}

function drawHeart(x,y,size,opacity,img){
  ctx.save();
  ctx.globalAlpha = opacity;
  ctx.drawImage(img, x-size/2, y-size/2, size, size);
  ctx.restore();
}

function animateHearts(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  hearts.forEach(h=>{
    h.angle+=0.05;
    h.x+=Math.sin(h.angle)*h.sway;
    h.y+=h.speed;
    drawHeart(h.x,h.y,h.size,h.opacity,h.img);
    if(h.y>canvas.height+50) h.y=-50;
  });
  requestAnimationFrame(animateHearts);
}

// ========== Cards setup ==========
const gameBoard = document.getElementById("gameBoard");
const heartImages = [];
for(let i=1;i<=18;i++){
  const img = new Image();
  img.src = `images/heart${i}.png`;
  heartImages.push(img);
}

// Shuffle
function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}

// Generate coordinates for heart shape
function heartCoords(n, scale=15, offsetX=window.innerWidth/2, offsetY=window.innerHeight/2){
  const points=[];
  for(let i=0;i<n;i++){
    const t=i/(n-1)*Math.PI*2;
    const x=16*Math.pow(Math.sin(t),3);
    const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    points.push({x: offsetX + x*scale, y: offsetY - y*scale});
  }
  return points;
}

const coords = heartCoords(36, 15, window.innerWidth/2, window.innerHeight/2);

let cardsArray=[...heartImages,...heartImages];
shuffle(cardsArray);

let firstCard=null, secondCard=null, lockBoard=false;

cardsArray.forEach((img, idx)=>{
  const card = document.createElement("div");
  card.classList.add("card");
  card.style.position="absolute";
  card.style.left = coords[idx].x + "px";
  card.style.top = coords[idx].y + "px";

  const inner = document.createElement("div");
  inner.classList.add("card-inner");

  const front = document.createElement("div");
  front.classList.add("card-front");
  front.textContent="?";

  const back = document.createElement("div");
  back.classList.add("card-back");
  const image = document.createElement("img");
  image.src = img.src;
  back.appendChild(image);

  inner.appendChild(front);
  inner.appendChild(back);
  card.appendChild(inner);
  gameBoard.appendChild(card);

  card.addEventListener("click", ()=>{
    if(lockBoard) return;
    if(card===firstCard) return;

    const romanticSound = new Audio("audio/romantic.mp3");
    romanticSound.currentTime=0;
    romanticSound.play();

    card.classList.add("flipped");

    if(!firstCard){
      firstCard=card;
    } else {
      secondCard=card;
      lockBoard=true;
      if(firstCard.querySelector(".card-back img").src === secondCard.querySelector(".card-back img").src){
        firstCard.classList.add("matched");
        secondCard.classList.add("matched");
        triggerHeartRain();
        resetBoard();
      } else {
        setTimeout(()=>{firstCard.classList.remove("flipped"); secondCard.classList.remove("flipped"); resetBoard();},800);
      }
    }
  });
});

function resetBoard(){ [firstCard,secondCard,lockBoard] = [null,null,false]; }

</script>
</body>
</html>

