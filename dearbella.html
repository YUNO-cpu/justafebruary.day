<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Heart Game</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/game.css">
</head>
<body class="dearbella">

   <img src="images/menu.png" id="menuBtn">
<div id="hint">
  FALL IN LOVE<br>
FLIP THE CARDS<br>
FIND THE MATCHES
</div>

  <div id="hintover">
    WIN THE GAME<br>
    ...<br>
    KISS ME LATER<br>
    ..............
  </div>

<div id="gameBoard"></div>

  <div id="sideMenu">
  <h3>Menu</h3>
  <button onclick="openMoreGames()">ðŸ•¹ More Games</button><br>
  <button onclick="openSettings()">ðŸ›  Settings</button>
</div>

<div id="moreGames" class="subMenu">
  <h3>More Games</h3>
  <button onclick="goGame1()">Game 1</button><br>
  <button onclick="goGame2()">Game 2</button><br>
  <button onclick="backToMenu()">â¬… Back</button>
</div>

<div id="settings" class="subMenu">
  <h3>Settings</h3>
  <button onclick="toggleMusic()">ðŸ–± Music</button><br>
  <button onclick="toggleSound()">â–¶ Sound</button><br>
  <button onclick="toggleVibration()">ðŸ›° Vibration</button><br>
  <button onclick="backToMenu()">â¬… Back</button>
</div>


<canvas id="heartCanvas"></canvas>

<script>
   const bgMusic = new Audio("audio/bg.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.4;

const winSound = new Audio("audio/win.mp3");
const hoverSound = new Audio("audio/hover.mp3");

// ========== Heart rain canvas ==========
const canvas = document.getElementById("heartCanvas");
const ctx = canvas.getContext("2d");
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let hearts = [];

function triggerHeartRain(){
  hearts = [];
  for(let i=0;i<30;i++){
    const img = new Image();
  img.src = "images/heartrain.png";
    hearts.push({
      x: Math.random()*canvas.width,
      y: -50,
      size: Math.random()*40+20,
      speed: Math.random()*3+2,
      img: img,
      opacity: 1
    });
  }
  animateHearts();

  // 3 ÑÐµÐºÑƒÐ½Ð´Ð¸Ð¹Ð½ Ð´Ð°Ñ€Ð°Ð° Ð·Ð¾Ð³ÑÐ¾Ð½Ð¾
  setTimeout(()=>{
    hearts = [];
  }, 3000);
}

function drawHeart(x,y,size,opacity,img){
  ctx.save();
  ctx.globalAlpha = opacity;
  ctx.drawImage(img, x-size/2, y-size/2, size, size);
  ctx.restore();
}

function animateHearts(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  hearts.forEach(h=>{
    h.y += h.speed;
    drawHeart(h.x,h.y,h.size,h.opacity,h.img);
  });
  if(hearts.length > 0){
    requestAnimationFrame(animateHearts);
  }
}

// ========== Cards setup ==========
const gameBoard = document.getElementById("gameBoard");

   gameBoard.classList.add("shake");
setTimeout(()=>gameBoard.classList.remove("shake"), 300);

// Heart images
const heartImages = [];
for(let i=1;i<=18;i++){
  const img = new Image();
  img.src = `images/heart${i}.png`;
  heartImages.push(img);
}

// Shuffle
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}

// ====== PIXEL HEART LAYOUT (36 cards) ======
const layout = [
  [0,0,1,1,0,1,1,0,0],
  [0,1,1,1,1,1,1,1,0],
  [1,1,1,1,1,1,1,1,1],
  [0,1,1,1,1,1,1,1,0],
  [0,0,1,1,1,1,1,0,0],
  [0,0,0,1,1,1,0,0,0],
  [0,0,0,0,1,0,0,0,0],
];
   
function getCardSize(){
  const w = gameBoard.offsetWidth;
  const h = gameBoard.offsetHeight;

  if(w > 1000){ 
    return 110; // desktop
  } else {
    return Math.min(w/9, h/8); // mobile
  }
}

function buildBoard(){
  gameBoard.innerHTML = "";

  const size = getCardSize();
  const startX = gameBoard.offsetWidth/2 - (layout[0].length/2)*size;
  const startY = gameBoard.offsetHeight/10;

  const coords = [];
  layout.forEach((row, y)=>{
    row.forEach((cell, x)=>{
      if(cell === 1){
        coords.push({
          x: startX + x*size,
          y: startY + y*size
        });
      }
    });
  });

  let cardsArray = [...heartImages, ...heartImages];
  shuffle(cardsArray);

  let firstCard=null, secondCard=null, lockBoard=false;
  let matchedCount = 0;
  const totalPairs = cardsArray.length / 2;

  cardsArray.forEach((img, idx)=>{
    if(!coords[idx]) return;

    const card = document.createElement("div");
    card.classList.add("card");
    card.style.width = size + "px";
    card.style.height = size + "px";
    card.style.left = coords[idx].x + "px";
    card.style.top = coords[idx].y + "px";
    card.style.position="absolute";

    const inner = document.createElement("div");
    inner.classList.add("card-inner");

    const front = document.createElement("div");
    front.classList.add("card-front");
    front.textContent="R";

    const back = document.createElement("div");
    back.classList.add("card-back");
    const image = document.createElement("img");
    image.src = img.src;
    back.appendChild(image);

    inner.appendChild(front);
    inner.appendChild(back);
    card.appendChild(inner);
    gameBoard.appendChild(card);

    card.addEventListener("click", ()=>{
      if(lockBoard) return;
      if(card===firstCard) return;

      card.classList.add("flipped");

      if(!firstCard){
        firstCard=card;
      } else {
        secondCard=card;
        lockBoard=true;

        if(firstCard.querySelector("img").src ===
           secondCard.querySelector("img").src){

          firstCard.classList.add("matched");
          secondCard.classList.add("matched");
          matchedCount++;
          resetBoard();

          if(matchedCount === totalPairs){
            triggerHeartRain();
            setTimeout(()=>alert("All pairs matched JUST LIKE US"),500);
          }

        } else {
          setTimeout(()=>{
            firstCard.classList.remove("flipped");
            secondCard.classList.remove("flipped");
            resetBoard();
          },800);
        }
      }
    });
  });

  function resetBoard(){
    [firstCard,secondCard,lockBoard] = [null,null,false];
  }
}

   const menuBtn = document.getElementById("menuBtn");
const sideMenu = document.getElementById("sideMenu");

let musicOn = true;
let soundOn = true;
let vibrationOn = true;

function toggleMenu(){
  sideMenu.classList.toggle("open");
}

menuBtn.onclick = toggleMenu;

function toggleMusic(){
  musicOn = !musicOn;
  musicOn ? bgMusic.play() : bgMusic.pause();
}

   function winSequence(){
  bgMusic.pause();
  winSound.play();
  document.body.classList.add("win");
}
   
function toggleSound(){
  soundOn = !soundOn;
}

function toggleVibration(){
  vibrationOn = !vibrationOn;
  if(vibrationOn && navigator.vibrate){
    navigator.vibrate(200);
  }
}
const moreGames = document.getElementById("moreGames");
const settings = document.getElementById("settings");

function openMoreGames(){
  sideMenu.classList.remove("open");
  moreGames.classList.add("open");
}

function openSettings(){
  sideMenu.classList.remove("open");
  settings.classList.add("open");
}

function backToMenu(){
  moreGames.classList.remove("open");
  settings.classList.remove("open");
  sideMenu.classList.add("open");
}

   buildBoard();
window.addEventListener("resize", buildBoard);

</script>
</body>
</html>


